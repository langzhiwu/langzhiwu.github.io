var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?s(o):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Ball=function(e){function t(){e.call(this),this.speed=500,this.skinName="resource/skins/BigBallSkin.exml",this.anchorOffsetX=this.anchorOffsetY=98.5}__extends(t,e);var i=(__define,t),s=i.prototype;return s.setColor=function(e){this.color_key=e,this.img_body.source=RES.getRes("bigball_"+e+"_png")},s.onupdate=function(e){this.y+=this.speed*e},s.error=function(){var e=new eui.Image(RES.getRes("wrong_png"));e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},t}(eui.Component);egret.registerClass(Ball,"Ball");var Game=function(e){function t(){e.call(this),this.R=!1,this.G=!1,this.B=!1,this.R_touch=!1,this.G_touch=!1,this.B_touch=!1,this._colordict=[],this.gamming=!1,this._def_move_speed=100,this._move_speed=100,this.brithTimer=0,this.brithTimer_span=2,this.def_brithTimer_span=1.5,this.isdebug=!1,this.Level1=[],this.Level2=[],this.Level3=[],this.last=0,this.skinName="resource/skins/GameSkin.exml",this.creat_colors_dict(),this.create_event(),this.show_begin(),this.BestScore=this.BestScore;var t=location.search;"?debug"==t&&(this.isdebug=!0)}__extends(t,e);var i=__define,s=t,o=s.prototype;return o.show_begin=function(){this.gp_scores.visible=!1,this.gp_buttons.anchorOffsetY=-1e3,this.gp_buttons.alpha=0,this.img_logo.anchorOffsetY=-1e3,this.img_logo.alpha=0,this.img_top.y=190,this.img_top.alpha=0,this.brithTimer=0,this.Score=0,this._move_speed=this._def_move_speed,this.brithTimer_span=this.def_brithTimer_span,egret.Tween.get(this.img_logo).to({alpha:1,anchorOffsetY:0},1e3,egret.Ease.cubicOut),egret.Tween.get(this.gp_buttons).wait(500).to({alpha:1,anchorOffsetY:0},1e3,egret.Ease.quadOut),egret.Tween.get(this.img_top).wait(1e3).to({alpha:1,x:540,y:460,rotation:0},1e3,egret.Ease.quadOut),this.R=this.B=this.G=!1,this.R_touch=this.B_touch=this.G_touch=!1,this.update_banner()},o.create_event=function(){this.img_g.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.ontouch_begin,this),this.img_b.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.ontouch_begin,this),this.img_r.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.ontouch_begin,this),this.img_g.addEventListener(egret.TouchEvent.TOUCH_END,this.ontouch_end,this),this.img_b.addEventListener(egret.TouchEvent.TOUCH_END,this.ontouch_end,this),this.img_r.addEventListener(egret.TouchEvent.TOUCH_END,this.ontouch_end,this),this.img_g.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.ontouch_out,this),this.img_b.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.ontouch_out,this),this.img_r.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.ontouch_out,this),this.btn_home.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_over_home,this),this.btn_ranking.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_over_ranking,this),this.btn_review.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_over_review,this),this.btn_replay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_over_replay,this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_help,this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_go,this),this.btn_sound_on.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_sound_on,this),this.btn_sound_off.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_sound_off,this),this.btn_sound_on.visible=!SoundManager.Instance.IsMuted,this.btn_sound_off.visible=SoundManager.Instance.IsMuted,egret.startTick(this.onupdate,this)},o.creat_colors_dict=function(){this._colordict[this.getColorKey()]=7,this.G=!0,this._colordict[this.getColorKey()]=1,this.R=!0,this._colordict[this.getColorKey()]=4,this.B=!0,this._colordict[this.getColorKey()]=7,this.G=!1,this._colordict[this.getColorKey()]=5,this.R=!1,this._colordict[this.getColorKey()]=2,this.B=!1,this.R=!0,this._colordict[this.getColorKey()]=3,this.R=!1,this.B=!0,this.G=!0,this._colordict[this.getColorKey()]=6,this.Level1.push(t.GetColorKey(!0,!1,!1)),this.Level1.push(t.GetColorKey(!1,!0,!1)),this.Level1.push(t.GetColorKey(!1,!1,!0)),this.Level2.push(t.GetColorKey(!0,!1,!1)),this.Level2.push(t.GetColorKey(!1,!0,!1)),this.Level2.push(t.GetColorKey(!1,!1,!0)),this.Level2.push(t.GetColorKey(!0,!0,!1)),this.Level2.push(t.GetColorKey(!1,!0,!0)),this.Level2.push(t.GetColorKey(!0,!1,!0)),this.Level3.push(t.GetColorKey(!0,!1,!1)),this.Level3.push(t.GetColorKey(!1,!0,!1)),this.Level3.push(t.GetColorKey(!1,!1,!0)),this.Level3.push(t.GetColorKey(!0,!0,!1)),this.Level3.push(t.GetColorKey(!1,!0,!0)),this.Level3.push(t.GetColorKey(!0,!1,!0)),this.Level3.push(t.GetColorKey(!0,!0,!1)),this.Level3.push(t.GetColorKey(!1,!0,!0)),this.Level3.push(t.GetColorKey(!0,!1,!0))},o.getColorKey=function(){return t.GetColorKey(this.R,this.G,this.B)},t.GetColorKey=function(e,t,i){return e+"|"+t+"|"+i},o.onupdate=function(e){var t=(e-this.last)/1e3;if(this.last=e,this.gamming){if(this.img_top.x+=this._move_speed*t,this.img_top.rotation+=this._move_speed*t*1.5,(this.img_top.x<=200||this.img_top.x>=880)&&(this._move_speed=-this._move_speed),this.brithTimer+=t,this.brithTimer>=this.brithTimer_span){this.brithTimer=0;var i;i=this.Score<=10?this.Level1:this.Score<=20?this.Level2:this.Level3;var s=new Ball;s.x=this.img_top.x,s.y=this.img_top.y;var o=Math.floor(Math.random()*i.length);s.setColor(this._colordict[i[o]]),this.gp_game.addChild(s)}for(var n=this.gp_game.numChildren-1;n>=0;n--){var s=this.gp_game.getChildAt(n);s.onupdate(t),s.y>=this.gp_game.height-s.height/2&&(this.isdebug||s.color_key==this._colordict[this.getColorKey()]?(this.Score+=1,SoundManager.Instance.PlayRight(),this.gp_game.removeChild(s),this.random_small_ball(s.x,s.color_key),this.hanele_level_speed()):(this.gamming=!1,s.error(),SoundManager.Instance.PlayWrong(),egret.Tween.get(this).wait(1e3).call(this.show_over,this)))}for(var n=this.gp_physical.numChildren-1;n>=0;n--){var r=this.gp_physical.getChildAt(n);r.onupdate(t)}}return!0},o.random_small_ball=function(e,t){for(var i=0;20>i;i++){var s=new SamllBall(t);s.x=e,this.gp_physical.addChild(s)}},o.hanele_level_speed=function(){var e=1+.3*Math.floor(this.Score/10);e>3.7&&(e=3.7);var t=this._def_move_speed*e;this._move_speed<0?this._move_speed=-t:this._move_speed=t,this.brithTimer_span=this.def_brithTimer_span-.3*e},o.ontouch_begin=function(e){this.gamming&&(e.currentTarget==this.img_g&&(this.G_touch=!0,this.img_g.anchorOffsetY=26),e.currentTarget==this.img_b&&(this.B_touch=!0,this.img_b.anchorOffsetY=26),e.currentTarget==this.img_r&&(this.R_touch=!0,this.img_r.anchorOffsetY=26),this.update_banner())},o.ontouch_end=function(e){this.gamming&&(e.currentTarget==this.img_g&&(this.G_touch=!1,this.img_g.anchorOffsetY=0),e.currentTarget==this.img_b&&(this.B_touch=!1,this.img_b.anchorOffsetY=0),e.currentTarget==this.img_r&&(this.R_touch=!1,this.img_r.anchorOffsetY=0))},o.ontouch_out=function(e){this.gamming&&(e.currentTarget==this.img_g&&(this.G_touch=!1,this.img_g.anchorOffsetY=0),e.currentTarget==this.img_b&&(this.B_touch=!1,this.img_b.anchorOffsetY=0),e.currentTarget==this.img_r&&(this.R_touch=!1,this.img_r.anchorOffsetY=0))},o.update_banner=function(){this.G=this.G_touch,this.B=this.B_touch,this.R=this.R_touch;var e=this._colordict[this.getColorKey()];this.img_banner.source=RES.getRes("banner_"+e+"_png")},o.onclick_help=function(){this.addChild(new Help)},o.onclick_go=function(){egret.Tween.get(this.img_logo).wait(500).to({alpha:0,anchorOffsetY:-1e3},1e3,egret.Ease.cubicOut),egret.Tween.get(this.gp_buttons).to({alpha:0,anchorOffsetY:-1e3},1e3,egret.Ease.quadOut),egret.Tween.get(this.img_top).wait(1e3).to({alpha:1,y:190},1e3,egret.Ease.quadOut).call(this.begin_game,this),this.gp_scores.visible=!0},o.onclick_sound_off=function(){SoundManager.Instance.IsMuted=!1,this.btn_sound_on.visible=!0,this.btn_sound_off.visible=!1,SoundManager.Instance.PlayBgm()},o.onclick_sound_on=function(){SoundManager.Instance.IsMuted=!0,this.btn_sound_on.visible=!1,this.btn_sound_off.visible=!0,SoundManager.Instance.StopBgm()},o.onclick_over_home=function(){this.gp_over.visible=!1,this.show_begin()},o.onclick_over_ranking=function(){alert("点击了排行榜")},o.onclick_over_review=function(){alert("点击了评论")},o.onclick_over_replay=function(){egret.Tween.get(this.img_top).to({alpha:1},1e3),this.brithTimer=0,this.Score=0,this._move_speed=this._def_move_speed,this.brithTimer_span=this.def_brithTimer_span,this.gamming=!0,this.gp_over.visible=!1},o.show_over=function(){var e=this;this.Score>this.BestScore&&egret.Tween.get(this).wait(2e3).call(function(){e.img_newrecord.visible=!0,SoundManager.Instance.PlayNewrecord(),e.BestScore=e.Score}),this.R=this.B=this.G=!1,this.R_touch=this.B_touch=this.G_touch=!1,this.update_banner(),this.gp_over.visible=!0,this.img_over_logo.anchorOffsetY=1e3,this.btn_overs.anchorOffsetY=1e3,this.btn_overs.alpha=this.img_over_logo.alpha=0,this.img_newrecord.visible=!1,egret.Tween.get(this.img_over_logo).wait(500).to({alpha:1,anchorOffsetY:0},1e3,egret.Ease.cubicOut),egret.Tween.get(this.btn_overs).to({alpha:1,anchorOffsetY:0},1e3,egret.Ease.quadOut),this.gp_game.removeChildren(),egret.Tween.get(this.img_top).to({alpha:0,x:540,rotation:0},1e3)},o.begin_game=function(){this.gamming=!0},i(o,"Score",function(){return parseInt(this.lb_score.text)},function(e){this.lb_score.text=e.toString()}),i(o,"BestScore",function(){var e=egret.localStorage.getItem("CVC_BEST_SCORE");return""==e||null==e?0:parseInt(e)},function(e){this.lb_best.text=e.toString(),egret.localStorage.setItem("CVC_BEST_SCORE",e.toString())}),t}(eui.Component);egret.registerClass(Game,"Game");var Help=function(e){function t(){e.call(this),this.skinName="resource/skins/HelpSkin.exml",this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_back,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onclick_back=function(){this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(Help,"Help");var SamllBall=function(e){function t(t){e.call(this),this.speed=0,this.source=RES.getRes("ball_"+t+"_png"),egret.Tween.get(this).to({y:-100-200*Math.random()},200*Math.random()+150,egret.Ease.cubicOut).to({y:0},800+200*Math.random(),egret.Ease.bounceOut).to({alpha:0},300+300*Math.random()).call(this.removethis,this),this.speed=300*Math.random()+50,Math.random()<.5&&(this.speed=-this.speed),this.anchorOffsetX=23.5,this.anchorOffsetY=47}__extends(t,e);var i=(__define,t),s=i.prototype;return s.removethis=function(){this.parent.removeChild(this)},s.onupdate=function(e){this.x+=this.speed*e},t}(eui.Image);egret.registerClass(SamllBall,"SamllBall");var SoundManager=function(){function e(){this.bgm=RES.getRes("bj_mp3"),this.newrecord=RES.getRes("newrecord_wav"),this.right=RES.getRes("right_wav"),this.wrong=RES.getRes("wrong_wav")}var t=__define,i=e,s=i.prototype;return t(e,"Instance",function(){return null==e.instance&&(e.instance=new e),e.instance}),s.PlayBgm=function(){this.IsMuted||(null!=this.bgmSoundChannel&&this.bgmSoundChannel.stop(),this.bgmSoundChannel=this.bgm.play(0,0))},s.StopBgm=function(){null!=this.bgmSoundChannel&&this.bgmSoundChannel.stop()},s.PlayClick=function(){this.IsMuted},s.PlayNewrecord=function(){this.IsMuted||this.newrecord.play(0,1)},s.PlayRight=function(){this.IsMuted||this.right.play(0,1)},s.PlayWrong=function(){this.IsMuted||this.wrong.play(0,1)},t(s,"IsMuted",function(){var e=egret.localStorage.getItem("CVC_SOUND_MUTED");return""==e||null==e?!1:"1"==e},function(e){e?egret.localStorage.setItem("CVC_SOUND_MUTED","1"):egret.localStorage.setItem("CVC_SOUND_MUTED","0")}),e.instance=null,e}();egret.registerClass(SoundManager,"SoundManager");var Start=function(e){function t(){e.call(this),this.skinName="resource/skins/StartSkin.exml",this.ani_begin(),SoundManager.Instance.PlayBgm()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.ani_begin=function(){this.img_logo.visible=!0,this.img_logo.alpha=0,egret.Tween.get(this.img_logo).wait(500).to({alpha:1},300).wait(1200).to({alpha:0},500).wait(300).call(this.to_game,this)},s.to_game=function(){egret.Tween.removeTweens(this.img_logo),this.parent.addChild(new Game),this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(Start,"Start");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},s.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},s.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},s.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.startCreateScene=function(){this.addChild(new Start)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,s){function o(e){t.call(s,e)}function n(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);