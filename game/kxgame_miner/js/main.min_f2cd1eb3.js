var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ViewUtil=function(){function t(){}return t.getShape=function(t,e,i,n){void 0===t&&(t=640),void 0===e&&(e=960),void 0===i&&(i=0),void 0===n&&(n=.7);var s=new egret.Shape;return s.graphics.beginFill(i,n),s.graphics.drawRect(0,0,t,e),s.graphics.endFill(),s.touchEnabled=!1,s},t.getArtNum=function(t,e){for(var i=new egret.Sprite,n=0;n<e.length;){var s=RES.getRes(t+e.charAt(n)),r=new egret.Bitmap(s);r.x=i.width+1,r.y=-s.textureHeight/2,i.addChild(r)}return i},t.hitTest=function(t,e){var i=t.getBounds(),n=e.getBounds();return i.x=t.x,i.y=t.y,n.x=e.x,n.y=e.y,i.intersects(n)},t}();__reflect(ViewUtil.prototype,"ViewUtil");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),GameLogic.getInstance().GameStage=this.stage,GameLogic.getInstance().GameStage_width=this.stage.stageWidth,GameLogic.getInstance().GameStage_height=this.stage.stageHeight;var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName?(this.stage.removeChild(this.loadingView),this.isResourceLoadEnd=!0,this.createScene()):(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),null!=GameLogic.getInstance().main&&GameLogic.getInstance().main.loadOver())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){GameLogic.getInstance().startMain()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Message=function(){function t(){}return t}();__reflect(Message.prototype,"Message");var SocketUtil=function(){function t(){this.BASE_HOST="211.159.162.154",this.PORT=8088,this.GAME_ID=1011,this.funcArr=new Array,this.thisObjectArr=new Array}return t.prototype.onConnect=function(){this.initSocket()},t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.initSocket=function(){this.socket=new egret.WebSocket,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.connect(this.BASE_HOST,this.PORT)},t.prototype.onReceiveMessage=function(t){var e=this.socket.readUTF(),i=JSON.parse(e);console.log("onReceive..."+i.type),console.log(i);var n=this.getFuncByFunctype(i.type),s=this.getThisObject(i.type);null==n||n.func(i,s.that)},t.prototype.onSocketOpen=function(t){console.log("onConnected.....")},t.prototype.sendMesg=function(t,e,i){if(void 0===i&&(i=!0),this.socket.connected){if(null!=t.func){this.onSetMsgFunc(t);var n=new ThisObject;n.type=t.type,n.that=e,this.setThisObject(n)}if(i){var s=JSON.stringify(t);this.socket.writeUTF(s),this.socket.flush(),console.log("onSend..."+t.type)}}},t.prototype.onSetMsgFunc=function(t){var e=this.funcArr.length;if(0==e)this.funcArr.push(t);else for(var i=0;e>i;i++){var n=this.funcArr[i];if(n.type==t.type){this.funcArr[i]=t;break}i==e-1&&this.funcArr.push(t)}},t.prototype.setThisObject=function(t){var e=this.thisObjectArr.length;if(0==e)this.thisObjectArr.push(t);else for(var i=0;e>i;i++){var n=this.thisObjectArr[i];if(n.type==t.type){this.thisObjectArr[i]=t;break}i==e-1&&this.thisObjectArr.push(t)}},t.prototype.getThisObject=function(t){for(var e=this.thisObjectArr.length,i=0;e>i;i++){var n=this.thisObjectArr[i];if(n.type==t)return n}return null},t.prototype.getFuncByFunctype=function(t){for(var e=this.funcArr.length,i=0;e>i;i++){var n=this.funcArr[i];if(n.type==t)return n}return null},t.prototype.disConnected=function(){this.socket&&this.socket.connected&&this.socket.close()},t}();__reflect(SocketUtil.prototype,"SocketUtil");var ThisObject=function(){function t(){}return t}();__reflect(ThisObject.prototype,"ThisObject");var GameLogic=function(){function t(){}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.startMain=function(){this.removeGame(),this.main=new MainScene,this.GameStage.addChild(this.main)},t.prototype.removeMain=function(){null!=this.main&&null!=this.main.parent&&this.main.parent.removeChild(this.main)},t.prototype.getMonsterVOByID=function(t){for(var e=0;e<this.data.length;e++)if(this.data[e].id==t)return this.data[e];return null},t.prototype.startGame=function(){if(this.removeMain(),null==this.data){this.data=[];for(var t=RES.getRes("mission_json"),e=0;e<t.length;e++){var i=new MonsterVO;i.id=parseInt(t[e].id),i.image=t[e].image,i.max_num=parseInt(t[e].max_num),i.left=parseInt(t[e].left),i.pos=parseInt(t[e].pos),i.movetype=parseInt(t[e].movetype),i.speedtime=parseInt(t[e].speedtime),i.score=parseInt(t[e].score),i.posX=parseInt(t[e].posX),i.posY=parseInt(t[e].posY),this.data.push(i)}}this.game=new GameScene,this.GameStage.addChild(this.game)},t.prototype.removeGame=function(){null!=this.game&&null!=this.game.parent&&this.game.parent.removeChild(this.game)},t}();__reflect(GameLogic.prototype,"GameLogic");var MathUtil=function(){function t(){}return t}();__reflect(MathUtil.prototype,"MathUtil");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.skinName="GameOverSkin",e.resetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.resetHandler,e),e}return __extends(e,t),e.prototype.resetHandler=function(){GameLogic.getInstance().startMain()},e}(eui.Component);__reflect(GameOver.prototype,"GameOver");var GameScene=function(t){function e(){var e=t.call(this)||this;e.score=0,e.score2=0,e.playing=!1,e._syncCatchedID=-1,e._totalTime=30,e.curDotNum=0,e.skinName="GameSceneSkin";var i=new Message;return i.uid=GameLogic.getInstance().user_info.user_uid,i.type="startgame",i.func=e.onStartGameHandler,SocketUtil.getInstance().sendMesg(i,e,!1),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.ship1.x=this.ship1.zeroX=this.ship_bg1.x=this.myImg1.x=GameLogic.getInstance().GameStage_width/2-250,this.ship2.x=this.ship2.zeroX=this.ship_bg2.x=this.myImg2.x=GameLogic.getInstance().GameStage_width/2+250,this.myImg1.visible=!1,this.myImg2.visible=!1,this.monsterArr=[],this.score_txt.visible=!1,this.score_txt2.visible=!1,this.initMonsters(),this._waitMask=new egret.Sprite,this.addChild(this._waitMask),this._waitMask.graphics.beginFill(0,.6),this._waitMask.graphics.drawRect(0,GameLogic.getInstance().GameStage_height/2-150,GameLogic.getInstance().GameStage_width,300),this._waitMask.graphics.endFill(),this._waitTxt=new eui.Label("等待对方"),this._waitTxt.size=60,this._waitTxt.textColor=16777215,this._waitMask.addChild(this._waitTxt),this._waitMask.x=this._waitMask.anchorOffsetX=GameLogic.getInstance().GameStage_width/2,this._waitMask.y=this._waitMask.anchorOffsetY=GameLogic.getInstance().GameStage_height/2,this._waitTxt.x=GameLogic.getInstance().GameStage_width/2,this._waitTxt.y=GameLogic.getInstance().GameStage_height/2,this._waitTxt.anchorOffsetX=this._waitTxt.width/2,this._waitTxt.anchorOffsetY=this._waitTxt.height/2,this.onStartTimer(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this)},e.prototype.onStartTimer=function(){this._timer=new egret.Timer(100,100),this._timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this._timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this._timer.start()},e.prototype.timerFunc=function(){this.curDotNum++;for(var t="等待对方",e=0;e<this.curDotNum;e++)t+=".";this._waitTxt.text=t,this.curDotNum>=4&&(this.curDotNum=0)},e.prototype.timerComFunc=function(){this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this._timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this._timer=null},e.prototype.initMonsters=function(){this.removeMonsters();var t=GameLogic.getInstance().data;if(null!=t)for(var e=0;e<t.length;e++){var i=new Monster(t[e]);this.addChild(i),this.monsterArr.push(i)}},e.prototype.GetPosAndInfo=function(){},e.prototype.setScore=function(t,e){e?(this.score_txt.text=t.toString(),this.score_txt.visible=!0,this.score+=t,egret.Tween.get(this.score_txt).to({x:this.total_score_txt.x,y:this.total_score_txt.y},1e3).call(this.clearScore,this)):(this.score_txt2.text=t.toString(),this.score_txt2.visible=!0,this.score2+=t,egret.Tween.get(this.score_txt2).to({x:this.total_score_txt2.x,y:this.total_score_txt2.y},1e3).call(this.clearScore,this))},e.prototype.clearScore=function(){this.total_score_txt.text=this.score.toString(),this.total_score_txt2.text=this.score2.toString(),this.score_txt.visible=!1,this.score_txt.y=100,this.score_txt.alpha=1,this.score_txt2.visible=!1,this.score_txt2.y=100,this.score_txt2.alpha=1},e.prototype.addMonster=function(t){var e=GameLogic.getInstance().getMonsterVOByID(t);if(null!=e){var i=new Monster(e);this.addChild(i),this.monsterArr.push(i)}},e.prototype.chectCatch=function(t){for(var e=0;e<this.monsterArr.length;e++)if(ViewUtil.hitTest(this.monsterArr[e],t)){this._syncCatchedID=this.monsterArr[e].vo.id,t.catchIt(this.monsterArr[e]),this.monsterArr.splice(e,1);break}},e.prototype.start=function(){this.playing&&(this.myShip.start(),this.timerSyncFunc())},e.prototype.onStartGameHandler=function(t,e){GameLogic.getInstance().user_info.user_uid==t.members[0]?(e.myShip=e.ship1,e.otherShip=e.ship2,e.myImg1.visible=!0):(e.myShip=e.ship2,e.otherShip=e.ship1,e.myImg2.visible=!0),e.myShip.prepareStart(),e.otherShip.prepareStart(),GameLogic.getInstance().Game_Room_ID=t.gameRoomId,e.addSyncListener();var i=egret.Tween.get(e._waitMask);i.to({rotation:720,scaleX:0,scaleY:0},1e3),egret.setTimeout(function(){e.playing=!0,e.onStartSyncTimer()},e,1e3)},e.prototype.addSyncListener=function(){var t=new Message;t.uid=GameLogic.getInstance().user_info.user_uid,t.type="frSyncpos",t.func=this.syncHandler,SocketUtil.getInstance().sendMesg(t,this,!1)},e.prototype.syncHandler=function(t,e){e.otherShip.rotation=t.angle,e.otherShip.start()},e.prototype.onStartSyncTimer=function(){null==this._syncTimer&&(this._syncTimer=new egret.Timer(1e3,30),this._syncTimer.addEventListener(egret.TimerEvent.TIMER,this.timerHandler,this),this._syncTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this._syncTimer.start())},e.prototype.timerHandler=function(){this._totalTime--,this.timeLab.text=this._totalTime.toString()},e.prototype.onTimerComplete=function(){this.playing=!1;var t=new GameOver;this.addChild(t)},e.prototype.timerSyncFunc=function(){var t=new Message;t.posx=this.myShip.x,t.posy=this.myShip.y,t.angle=this.myShip.rotation,t.catched=!1,t.uid=GameLogic.getInstance().user_info.user_uid,t.func=null,-1==this._syncCatchedID&&(t.catched=!0,t.monsterID=this._syncCatchedID,this._syncCatchedID=-1),t.type="syncpos",t.gameRoomId=GameLogic.getInstance().Game_Room_ID,SocketUtil.getInstance().sendMesg(t,this)},e.prototype.removeMonsters=function(){for(var t=0;t<this.monsterArr.length;t++)null!=this.monsterArr[t]&&null!=this.monsterArr[t].parent&&(this.monsterArr[t].parent.removeChild(this.monsterArr[t]),this.monsterArr[t]=null);this.monsterArr=[]},e.prototype.gameOver=function(){GameLogic.getInstance().startMain()},e}(eui.Component);__reflect(GameScene.prototype,"GameScene");var MainScene=function(t){function e(){var e=t.call(this)||this;return GameLogic.getInstance().main=e,e.skinName="MainSceneSkin",SocketUtil.getInstance().disConnected(),SocketUtil.getInstance().onConnect(),egret.setTimeout(function(){this.loginToGame()},e,2e3),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),RES.loadGroup("game")},e.prototype.loginToGame=function(){var t=new Message;t.params="Hello world!!!哈哈",t.func=this.loginHandler,t.functype="login_func",t.type="login",SocketUtil.getInstance().sendMesg(t,this)},e.prototype.loginHandler=function(t,e){var i=new UserVO;i.user_name=t.user.name,i.user_uid=t.user.uid,GameLogic.getInstance().user_info=i,e.loadOver()},e.prototype.loadOver=function(){null!=this.start_btn&&(this.start_btn.visible=!0,this.start_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this))},e.prototype.start=function(){var t=new Message;t.params="Hello world!!!哈哈",t.func=this.inRoomHandler,t.functype="null",t.type="inRoom",t.uid=GameLogic.getInstance().user_info.user_uid,SocketUtil.getInstance().sendMesg(t,this)},e.prototype.inRoomHandler=function(t,e){console.log("inRoom....."),GameLogic.getInstance().startGame()},e}(eui.Component);__reflect(MainScene.prototype,"MainScene");var Monster=function(t){function e(e){var i=t.call(this)||this;return i.vo=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.bg=new egret.Bitmap(RES.getRes(this.vo.image)),this.addChild(this.bg),this.x=this.vo.posX,this.y=this.vo.posY},e.prototype.removeFromParent=function(){this.parent.removeChild(this)},e}(egret.Sprite);__reflect(Monster.prototype,"Monster");var Ship=function(t){function e(){var e=t.call(this)||this;return e.catchID=-1,e.h=580,e.r=70,e.go=!1,e.speed=3,e.skinName="ShipSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.zeroY=110,this.line=new egret.Shape,this.parent.addChild(this.line)},e.prototype.catchIt=function(t){this.tw2.setPaused(!0),this.catched=t,this.catched.x=(80-t.width)/2,this.catched.y=45,this.catchID=t.vo.id,t.removeFromParent(),this.addChild(t);var e=this.getTime(this.getDistance(this.x,this.y));this.tw2=egret.Tween.get(this,{onChange:this.changeline,onChangeObj:this}),this.tw2.to({x:this.zeroX,y:this.zeroY},e).call(this.setScore,this)},e.prototype.prepareStart=function(){this.isCatch=!1,this.tw1=egret.Tween.get(this,{loop:!0}),this.rotation=this.r,this.tw1.to({rotation:-this.r},3e3).wait(100).to({rotation:this.r},3e3)},e.prototype.getTime=function(t){var e=20*t/this.speed;return e-e%100},e.prototype.getDistance=function(t,e){var i=Math.abs(this.zeroX-t),n=Math.abs(this.zeroY-e),s=Math.pow(i,2)+Math.pow(n,2);return Math.sqrt(s)},e.prototype.start=function(){if(!this.isCatch&&null!=this.tw1){this.tw1.setPaused(!0),this.isCatch=!0,this.tw2=null,this.tw2=egret.Tween.get(this,{onChange:this.changeline,onChangeObj:this}),this.line.visible=!0;var t=this.rotation,e=t*Math.PI/180,i=Math.tan(e),n=i*this.h,s=0,r=0;n>0?n>this.zeroX?(s=0,r=this.zeroY+this.zeroX/i):(s=this.zeroX-n,r=this.zeroY+this.h):(s=GameLogic.getInstance().GameStage_width,Math.abs(n)>GameLogic.getInstance().GameStage_width-this.zeroX?(s=GameLogic.getInstance().GameStage_width,r=this.zeroY+this.zeroX/Math.abs(i)):(s=this.zeroX+Math.abs(n),r=this.zeroY+this.h)),s=parseInt(s.toFixed(0)),r=parseInt(r.toFixed(0));var o=this.getTime(this.getDistance(s,r));this.tw2.to({x:s,y:r},o).wait(100).call(this.goBack,this)}},e.prototype.goBack=function(){this.catched=new egret.DisplayObjectContainer,this.tw2=egret.Tween.get(this,{onChange:this.changeline,onChangeObj:this});var t=this.getTime(this.getDistance(this.x,this.y));this.tw2.to({x:this.zeroX,y:this.zeroY},t).call(this.setScore,this)},e.prototype.changeline=function(){this.line.graphics.clear(),this.line.graphics.lineStyle(4,10592673),this.line.graphics.moveTo(this.zeroX,this.zeroY),this.line.graphics.lineTo(this.x,this.y),this.line.graphics.endFill(),null!=GameLogic.getInstance().game&&null==this.catched&&GameLogic.getInstance().game.chectCatch(this)},e.prototype.setScore=function(){null!=this.catched&&null!=this.catched.parent&&(this.catched.parent.removeChild(this.catched),GameLogic.getInstance().game.setScore(this.catched.vo.score,this.x<GameLogic.getInstance().GameStage_width/2)),this.goOn(),this.line.visible=!1,this.catched=null},e.prototype.goOn=function(){this.isCatch=!1,this.tw1.setPaused(!1)},e.prototype.clear=function(){egret.Tween.removeTweens(this),this.tw1=null,this.tw2=null,this.isCatch=!1},e}(eui.Component);__reflect(Ship.prototype,"Ship");var MonsterVO=function(){function t(){}return t}();__reflect(MonsterVO.prototype,"MonsterVO");var SelfPosVO=function(){function t(){}return t}();__reflect(SelfPosVO.prototype,"SelfPosVO");var UserVO=function(){function t(){}return t}();__reflect(UserVO.prototype,"UserVO");