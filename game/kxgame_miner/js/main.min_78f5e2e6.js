var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),MathUtil=function(){function t(){}return t}();__reflect(MathUtil.prototype,"MathUtil");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),GameLogic.getInstance().GameStage=this.stage,GameLogic.getInstance().GameStage_width=this.stage.stageWidth,GameLogic.getInstance().GameStage_height=this.stage.stageHeight;var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName?(this.stage.removeChild(this.loadingView),this.isResourceLoadEnd=!0,this.createScene()):(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),null!=GameLogic.getInstance().main&&GameLogic.getInstance().main.loadOver())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){GameLogic.getInstance().startMain()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Message=function(){function t(){}return t}();__reflect(Message.prototype,"Message");var SocketUtil=function(){function t(){this.BASE_HOST="211.159.162.154",this.PORT=8088,this.GAME_ID=1011,this.funcArr=new Array,this.initSocket()}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.initSocket=function(){this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.connect(this.BASE_HOST,this.PORT)},t.prototype.onReceiveMessage=function(t){var e=new egret.ByteArray;this.socket.readBytes(e);var i=e.readUTF(),n=this.socket.readUTF(),s=JSON.parse(n);if(this.GAME_ID==parseInt(s.gameid)){var o=this.getFuncByFunctype(s.functype);null==o||o.func()}console.log("receiveMsg:"+i)},t.prototype.onSocketOpen=function(t){console.log("onConnected.....")},t.prototype.sendMesg=function(t){if(console.log(this.socket.connected),this.socket.connected){this.onSetMsgFunc(t),t.gameid=this.GAME_ID;var e=JSON.stringify(t);this.socket.writeUTF(e),this.socket.flush(),console.log("sendMesg...")}},t.prototype.onSetMsgFunc=function(t){for(var e=this.funcArr.length,i=0;e>i;i++){var n=this.funcArr[i];if(n.functype==t.functype){this.funcArr[i]=t;break}i==e-1&&this.funcArr.push(t)}},t.prototype.getFuncByFunctype=function(t){for(var e=this.funcArr.length,i=0;e>i;i++){var n=this.funcArr[i];if(n.functype==t)return n}return null},t}();__reflect(SocketUtil.prototype,"SocketUtil");var GameLogic=function(){function t(){}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.startMain=function(){this.removeGame(),null==this.main&&(this.main=new MainScene),this.GameStage.addChild(this.main)},t.prototype.removeMain=function(){null!=this.main&&null!=this.main.parent&&this.main.parent.removeChild(this.main)},t.prototype.getMonsterVOByID=function(t){for(var e=0;e<this.data.length;e++)if(this.data[e].id==t)return this.data[e];return null},t.prototype.startGame=function(){if(this.removeMain(),null==this.data){this.data=[];for(var t=RES.getRes("mission_json"),e=0;e<t.length;e++){var i=new MonsterVO;i.id=parseInt(t[e].id),i.image=t[e].image,i.max_num=parseInt(t[e].max_num),i.left=parseInt(t[e].left),i.pos=parseInt(t[e].pos),i.movetype=parseInt(t[e].movetype),i.speedtime=parseInt(t[e].speedtime),i.score=parseInt(t[e].score),i.posX=parseInt(t[e].posX),i.posY=parseInt(t[e].posY),this.data.push(i)}}null==this.game&&(this.game=new GameScene),this.GameStage.addChild(this.game)},t.prototype.removeGame=function(){null!=this.game&&null!=this.game.parent&&this.game.parent.removeChild(this.game)},t}();__reflect(GameLogic.prototype,"GameLogic");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var ViewUtil=function(){function t(){}return t.getShape=function(t,e,i,n){void 0===t&&(t=640),void 0===e&&(e=960),void 0===i&&(i=0),void 0===n&&(n=.7);var s=new egret.Shape;return s.graphics.beginFill(i,n),s.graphics.drawRect(0,0,t,e),s.graphics.endFill(),s.touchEnabled=!1,s},t.getArtNum=function(t,e){for(var i=new egret.Sprite,n=0;n<e.length;){var s=RES.getRes(t+e.charAt(n)),o=new egret.Bitmap(s);o.x=i.width+1,o.y=-s.textureHeight/2,i.addChild(o)}return i},t.hitTest=function(t,e){var i=t.getBounds(),n=e.getBounds();return i.x=t.x,i.y=t.y,n.x=e.x,n.y=e.y,i.intersects(n)},t}();__reflect(ViewUtil.prototype,"ViewUtil");var GameScene=function(t){function e(){var e=t.call(this)||this;return e.score=0,e.skinName="GameSceneSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.ship1.x=this.ship1.zeroX=this.ship_bg1.x=GameLogic.getInstance().GameStage_width/2-250,this.ship2.x=this.ship2.zeroX=this.ship_bg2.x=GameLogic.getInstance().GameStage_width/2+250,this.monsterArr=[],this.score_txt.visible=!1,this.initMonsters(),this.GetPosAndInfo(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this)},e.prototype.initMonsters=function(){this.removeMonsters();var t=GameLogic.getInstance().data;if(null!=t)for(var e=0;e<t.length;e++){var i=new Monster(t[e]);this.addChild(i),this.monsterArr.push(i)}},e.prototype.GetPosAndInfo=function(){this.myShip=this.ship1},e.prototype.setScore=function(t){this.score_txt.text=t.toString(),this.score_txt.visible=!0,this.score+=t,egret.Tween.get(this.score_txt).to({x:this.total_score_txt.x,y:this.total_score_txt.y},1e3).call(this.clearScore,this)},e.prototype.clearScore=function(){this.total_score_txt.text=this.score.toString(),this.score_txt.visible=!1,this.score_txt.y=100,this.score_txt.alpha=1,this.myShip.goOn()},e.prototype.addMonster=function(t){var e=GameLogic.getInstance().getMonsterVOByID(t);if(null!=e){var i=new Monster(e);this.addChild(i),this.monsterArr.push(i)}},e.prototype.chectCatch=function(){for(var t=0;t<this.monsterArr.length;t++)if(ViewUtil.hitTest(this.monsterArr[t],this.myShip)){this.myShip.catchIt(this.monsterArr[t]),this.monsterArr.splice(t,1);break}},e.prototype.start=function(){this.myShip.start();var t=new Message;SocketUtil.getInstance().sendMesg(t)},e.prototype.removeMonsters=function(){for(var t=0;t<this.monsterArr.length;t++)null!=this.monsterArr[t]&&null!=this.monsterArr[t].parent&&(this.monsterArr[t].parent.removeChild(this.monsterArr[t]),this.monsterArr[t]=null);this.monsterArr=[]},e.prototype.gameOver=function(){GameLogic.getInstance().startMain()},e}(eui.Component);__reflect(GameScene.prototype,"GameScene");var MainScene=function(t){function e(){var e=t.call(this)||this;return GameLogic.getInstance().main=e,e.skinName="MainSceneSkin",SocketUtil.getInstance(),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.loadOver()},e.prototype.loadOver=function(){null!=this.start_btn&&(this.start_btn.visible=!0,this.start_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this))},e.prototype.start=function(){GameLogic.getInstance().startGame()},e}(eui.Component);__reflect(MainScene.prototype,"MainScene");var Monster=function(t){function e(e){var i=t.call(this)||this;return i.vo=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.bg=new egret.Bitmap(RES.getRes(this.vo.image)),this.addChild(this.bg),this.x=this.vo.posX,this.y=this.vo.posY},e.prototype.removeFromParent=function(){this.parent.removeChild(this)},e}(egret.Sprite);__reflect(Monster.prototype,"Monster");var Ship=function(t){function e(){var e=t.call(this)||this;return e.catchID=-1,e.h=580,e.r=70,e.go=!1,e.speed=3,e.skinName="ShipSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.zeroY=110,this.line=new egret.Shape,this.parent.addChild(this.line),this.prepareStart()},e.prototype.catchIt=function(t){this.tw2.setPaused(!0),this.catched=t,this.catched.x=(80-t.width)/2,this.catched.y=45,this.catchID=t.vo.id,t.removeFromParent(),this.addChild(t);var e=this.getTime(this.getDistance(this.x,this.y));this.tw2=egret.Tween.get(this,{onChange:this.changeline,onChangeObj:this}),this.tw2.to({x:this.zeroX,y:this.zeroY},e).call(this.setScore,this)},e.prototype.prepareStart=function(){this.isCatch=!1,this.tw1=egret.Tween.get(this,{loop:!0}),this.rotation=this.r,this.tw1.to({rotation:-this.r},3e3).wait(100).to({rotation:this.r},3e3)},e.prototype.getTime=function(t){var e=20*t/this.speed;return e-e%100},e.prototype.getDistance=function(t,e){var i=Math.abs(this.zeroX-t),n=Math.abs(this.zeroY-e),s=Math.pow(i,2)+Math.pow(n,2);return Math.sqrt(s)},e.prototype.start=function(){if(!this.isCatch&&null!=this.tw1){this.tw1.setPaused(!0),this.isCatch=!0,this.tw2=null,this.tw2=egret.Tween.get(this,{onChange:this.changeline,onChangeObj:this}),this.line.visible=!0;var t=this.rotation,e=t*Math.PI/180,i=Math.tan(e),n=i*this.h,s=0,o=0;n>0?n>this.zeroX?(s=0,o=this.zeroY+this.zeroX/i):(s=this.zeroX-n,o=this.zeroY+this.h):(s=GameLogic.getInstance().GameStage_width,Math.abs(n)>GameLogic.getInstance().GameStage_width-this.zeroX?(s=GameLogic.getInstance().GameStage_width,o=this.zeroY+this.zeroX/Math.abs(i)):(s=this.zeroX+Math.abs(n),o=this.zeroY+this.h)),s=parseInt(s.toFixed(0)),o=parseInt(o.toFixed(0));var r=this.getTime(this.getDistance(s,o));this.tw2.to({x:s,y:o},r).wait(100).call(this.goBack,this)}},e.prototype.goBack=function(){this.catched=new egret.DisplayObjectContainer,this.tw2=egret.Tween.get(this,{onChange:this.changeline,onChangeObj:this});var t=this.getTime(this.getDistance(this.x,this.y));this.tw2.to({x:this.zeroX,y:this.zeroY},t).call(this.setScore,this)},e.prototype.changeline=function(){this.line.graphics.clear(),this.line.graphics.lineStyle(4,10592673),this.line.graphics.moveTo(this.zeroX,this.zeroY),this.line.graphics.lineTo(this.x,this.y),this.line.graphics.endFill(),null!=GameLogic.getInstance().game&&null==this.catched&&GameLogic.getInstance().game.chectCatch()},e.prototype.setScore=function(){null!=this.catched&&null!=this.catched.parent?(this.catched.parent.removeChild(this.catched),GameLogic.getInstance().game.setScore(this.catched.vo.score)):this.goOn(),this.line.visible=!1,this.catched=null},e.prototype.goOn=function(){this.isCatch=!1,this.tw1.setPaused(!1)},e.prototype.clear=function(){egret.Tween.removeTweens(this),this.tw1=null,this.tw2=null,this.isCatch=!1},e}(eui.Component);__reflect(Ship.prototype,"Ship");var MonsterVO=function(){function t(){}return t}();__reflect(MonsterVO.prototype,"MonsterVO");