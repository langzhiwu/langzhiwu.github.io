var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BackGround=function(e){function t(){e.call(this),this.addUpdateFunc=null,this._colors=[13016173,16275560,5552520,7692720,5358035],this._colors2=["#c69c6d","#f85868","54b988","7561b0","51c1d3"],this.last=0,this.random=0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.on_add,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.getBGColor=function(){return this._colors2[this.random]},n.StopAni=function(){egret.stopTick(this.onupdate,this)},n.BeginAni=function(){egret.startTick(this.onupdate,this)},n.on_add=function(){if(this.RandomBackGroud(),0==this.gp_paopao.numChildren){for(var e=1;5>e;e++){var t=new eui.Image;t.source=RES.getRes("pao"+e+"_png"),t.y=1920*Math.random(),this.gp_paopao.addChild(t)}this.gp_paopao.getChildAt(0).x=108,this.gp_paopao.getChildAt(2).x=540,this.gp_paopao.getChildAt(1).x=324,this.gp_paopao.getChildAt(3).x=756}},n.onupdate=function(e){var t=e-this.last;this.last=e;for(var i=0;i<this.gp_paopao.numChildren;i++){var n=this.gp_paopao.getChildAt(i);n.y+=.01*t,n.y>1920&&(n.y=-n.height)}return null!=this.addUpdateFunc&&this.addUpdateFunc.call(this.thisobj,t/1e3),!0},n.RandomBackGroud=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.RandomBackGroud,this);do var e=Math.floor(Math.random()*this._colors.length);while(e==this.random);this.random=e,this.rect_bg.fillColor=this._colors[e]},n.addUpdateEvent=function(e,t){this.addUpdateFunc=e,this.thisobj=t},t}(eui.Component);egret.registerClass(BackGround,"BackGround");var RenState;!function(e){e[e.Stand=0]="Stand",e[e.Handle=1]="Handle",e[e.Dead=2]="Dead"}(RenState||(RenState={}));var Game=function(e){function t(){e.call(this),this._brith_time=1,this._brith_time_over=0,this._move_speed=1800,this.level1=6,this.level2=20,this.level3=32,this.level4=52,this.renState=RenState.Dead,this.ren_dir=0,this.floor_index=0,this.skinName="resource/skins/GameSkin.exml",this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.ontap,this),this.img_bg.addUpdateEvent(this.onUpdate,this),this.lb_best.text=this.Best.toString(),this.btn_home.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_home,this),this.btn_ranking.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_ranking,this),this.btn_review.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_review,this),this.btn_replay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_replay,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.resetgame,this),this.img_bg.BeginAni();var t=location.search;if("?debug"==t&&(GameConfig.DEBUG_MODE=!0),GameConfig.ScaleMode==egret.StageScaleMode.NO_BORDER){var i=document.documentElement.clientWidth,n=document.documentElement.clientHeight,s=i/1080,o=1920*s-n;o*=n/1920,this.gp_top_ui.y=o}}__extends(t,e);var i=__define,n=t,s=n.prototype;return i(t,"Instance",function(){return null==t.instance&&(t.instance=new t),t.instance}),s.resetgame=function(){this._brith_time=GameConfig.Def_Brith_Time,this._move_speed=GameConfig.Def_Move_Speed,this.level1=GameConfig.Level1,this.level2=GameConfig.Level2,this.level3=GameConfig.Level3,this.level4=GameConfig.Level4,this.img_record.visible=!1,this._brith_time_over=0,this.gp_game.y=0,this.gp_place.scaleX=this.gp_place.scaleY=1,this.ren_dir=0,this.Score=0,this.stand();for(var e=this.gp_di.numChildren-1;e>=1;e--)this.gp_di.removeChildAt(e);this.gp_bang.removeChildren(),this.gp_place.y=1444,this.renState=RenState.Stand,this.gp_gameover.visible=!1,this.floor_index=0},s.onUpdate=function(e){if(this.renState!=RenState.Dead&&!(e>1)){if(this._brith_time_over+=parseFloat(e),this._brith_time_over>=this._brith_time){this._brith_time_over=0;var t=new eui.Image;Math.random()<.5?(t.source=RES.getRes("1_b_png"),t.name="1_b_png"):(t.source=RES.getRes("1_w_png"),t.name="1_w_png"),t.horizontalCenter=0,t.y=-1800,this.gp_bang.addChild(t)}for(var i=0;i<this.gp_bang.numChildren;i++){var n=this.gp_bang.getChildAt(i);if(n.y+=this._move_speed*e,n.y>0){this.gp_bang.removeChildAt(i),this.checkDead(n);break}}}},s.getScale=function(){return this.floor_index<=this.level1?1:this.floor_index<this.level2?.8:this.floor_index<this.level3?.7:this.floor_index<this.level4?.6:.5},s.ontap=function(){this.renState==RenState.Stand&&(this.img_bg.RandomBackGroud(),this.ren_dir+=1,this.ren_dir%2==1?this.img_ren.source=RES.getRes("1_w_1_png"):this.img_ren.source=RES.getRes("1_b_1_png"))},s.stand=function(){this.ren_dir%2==1?this.img_ren.source=RES.getRes("1_w_1_png"):this.img_ren.source=RES.getRes("1_b_1_png")},s.handle=function(){this.floor_index%2==1?(this.img_ren.source=RES.getRes("1_w_2_png"),SoundManager.Instance.PlayHa1()):(this.img_ren.source=RES.getRes("1_b_2_png"),SoundManager.Instance.PlayHa2()),this.renState=RenState.Handle},s.dead=function(){this.ren_dir%2==1?this.img_ren.source=RES.getRes("1_w_3_png"):this.img_ren.source=RES.getRes("1_b_3_png"),this.renState=RenState.Dead,SoundManager.Instance.PlayHit(),egret.Tween.get(this).wait(1e3).call(this.gameover,this);var e=this.gp_game.x+6*Math.random()+5,t=this.gp_game.x-6*Math.random()-5,i=this.gp_game.x,n=this.gp_game.y+6*Math.random()+10,s=this.gp_game.y-6*Math.random()-10,o=this.gp_game.y;egret.Tween.get(this.gp_game).to({x:e,y:n},100).to({x:t,y:s},100).to({x:i,y:o},100)},s.checkDead=function(e){if(GameConfig.DEBUG_MODE)return void this.addFloor();var t=this.ren_dir%2==0&&"1_b_png"==e.name;return t?void this.addFloor():(t=this.ren_dir%2==1&&"1_w_png"==e.name)?void this.addFloor():void this.dead()},s.addFloor=function(){this.Score+=2,this.floor_index+=1,egret.Tween.get(this.img_ren).call(this.handle,this).wait(100).call(this.upmove,this).wait(100).call(this.stand,this);var e=new eui.Image;e.source=RES.getRes("1_m_png"),e.scaleY=e.scaleX=this.getScale(),e.horizontalCenter=0;var t=0;this.floor_index<this.level1?t=41*-this.gp_di.numChildren*1:(t-=41*this.level1*1,this.floor_index<this.level2?t-=(this.gp_di.numChildren-this.level1)*(41*.8):(t-=(this.level2-this.level1)*(41*.8),this.floor_index<this.level3?t-=28.7*(this.gp_di.numChildren-this.level2):(t-=28.7*(this.level3-this.level2),this.floor_index<this.level4?t-=(this.gp_di.numChildren-this.level3)*(41*.6):(t-=(this.level4-this.level3)*(41*.6),t-=20.5*(this.gp_di.numChildren-this.level4))))),e.y=t,this.gp_di.addChild(e),this.gp_place.scaleX!=this.getScale()&&egret.Tween.get(this.gp_place).to({scaleX:this.getScale(),scaleY:this.getScale()},200)},s.upmove=function(){var e=this.gp_place.y;if(this.floor_index==this.level1+1&&(e+=200*(1-this.getScale()),this._brith_time*=GameConfig.Level1_Brith_Time,this._move_speed*=GameConfig.Level1_Move_Speed),this.floor_index==this.level2&&(e+=80*(1-this.getScale()),this._brith_time*=GameConfig.Level2_Brith_Time,this._move_speed*=GameConfig.Level2_Move_Speed),this.floor_index==this.level3&&(e+=20*(1-this.getScale()),this._brith_time*=GameConfig.Level3_Brith_Time,this._move_speed*=GameConfig.Level3_Move_Speed),this.floor_index==this.level4&&(e+=40*(1-this.getScale()),this._brith_time*=GameConfig.Level4_Brith_Time,this._move_speed*=GameConfig.Level3_Move_Speed),300==this.Score&&(this._brith_time*=GameConfig.Score300_Brith_Time,this._move_speed*=GameConfig.Score300_Move_Speed),300==this.Score&&(this._brith_time*=GameConfig.Score500_Brith_Time,this._move_speed*=GameConfig.Score500_Move_Speed),e-=41*this.getScale(),egret.Tween.get(this.gp_place).to({y:e},200),this.renState=RenState.Stand,this.gp_place.y<=640){var t=this.gp_game.y+41*this.getScale();egret.Tween.get(this.gp_game).to({y:t},200)}},s.onclick_home=function(){this.parent.addChild(Start.Instance),this.parent.removeChild(this)},s.onclick_ranking=function(){},s.onclick_review=function(){},s.onclick_replay=function(){this.gp_gameover.visible=!1,this.resetgame()},s.gameover=function(){this.gp_gameover.visible=!0,this.Score>this.Best&&(this.img_record.visible=!0,SoundManager.Instance.PlayRecord(),this.Best=this.Score)},i(s,"Score",function(){return parseInt(this.lb_score.text)},function(e){this.lb_score.text=e.toString()}),i(s,"Best",function(){var e=egret.localStorage.getItem("TB_BEST_SCORE");return""!=e&&null!=e?parseInt(e):0},function(e){egret.localStorage.setItem("TB_BEST_SCORE",e.toString()),this.lb_best.text=e.toString()}),t.instance=null,t}(eui.Component);egret.registerClass(Game,"Game");var GameConfig=function(){function e(){}var t=(__define,e);t.prototype;return e.DEBUG_MODE=!1,e.Def_Brith_Time=1,e.Def_Move_Speed=1800,e.Level1=6,e.Level2=20,e.Level3=32,e.Level4=52,e.Level1_Brith_Time=.8,e.Level2_Brith_Time=.8,e.Level3_Brith_Time=.8,e.Level4_Brith_Time=.9,e.Level1_Move_Speed=1,e.Level2_Move_Speed=1,e.Level3_Move_Speed=1,e.Level4_Move_Speed=1,e.Score300_Brith_Time=.7,e.Score300_Move_Speed=1.3,e.Score500_Brith_Time=.5,e.Score500_Move_Speed=2,e}();egret.registerClass(GameConfig,"GameConfig");var Help=function(e){function t(){e.call(this),this.skinName="resource/skins/HelpSkin.exml",this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onclick=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick,this),this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(Help,"Help");var SoundManager=function(){function e(){this.ha1=RES.getRes("ha1_mp3"),this.ha2=RES.getRes("ha2_mp3"),this.record=RES.getRes("record_mp3"),this.hit=RES.getRes("hit_mp3")}var t=__define,i=e,n=i.prototype;return t(e,"Instance",function(){return null==e.instance&&(e.instance=new e),e.instance}),n.PlayClick=function(){this.IsMuted},n.PlayHa1=function(){this.IsMuted||this.ha1.play(0,1)},n.PlayHa2=function(){this.IsMuted||this.ha2.play(0,1)},n.PlayRecord=function(){this.IsMuted||this.record.play(0,1)},n.PlayHit=function(){this.IsMuted||this.hit.play(0,1)},t(n,"IsMuted",function(){var e=egret.localStorage.getItem("TB_SOUND_MUTED");return""==e||null==e?!1:"1"==e},function(e){e?egret.localStorage.setItem("TB_SOUND_MUTED","1"):egret.localStorage.setItem("TB_SOUND_MUTED","0")}),e.instance=null,e}();egret.registerClass(SoundManager,"SoundManager");var Start=function(e){function t(){e.call(this),t.Instance=this,this.skinName="resource/skins/StartSkin.exml",this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_go,this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_help,this),this.btn_sound1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_sound_off,this),this.btn_sound2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_sound_on,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addtostage,this),this.ani_begin();SoundManager.Instance}__extends(t,e);var i=(__define,t),n=i.prototype;return n.addtostage=function(){this.img_bg.BeginAni()},n.ani_begin=function(){this.img_logo.visible=!0,this.img_logo.alpha=0,this.img_gamelogo.top=-350,this.btn_go.verticalCenter=1200,this.btn_di.bottom=-280,this.btn_ren.bottom=-280,this.btn_help.visible=!1,this.btn_sound2.visible=!1,this.btn_sound1.visible=!1,egret.Tween.get(this.img_logo).wait(500).to({alpha:1},300).wait(1200).to({alpha:0},500).wait(300).call(this.ani_show,this)},n.ani_show=function(){egret.Tween.get(this.img_gamelogo).to({top:280},200,egret.Ease.backOut),egret.Tween.get(this.btn_go).wait(300).to({verticalCenter:100},500,egret.Ease.backOut),egret.Tween.get(this.btn_ren).wait(600).to({bottom:280},500,egret.Ease.backOut),egret.Tween.get(this.btn_di).wait(800).to({bottom:0},500,egret.Ease.backOut).call(this.ani_logo_jump,this)},n.ani_logo_jump=function(){this.img_logo.visible=!1,this.btn_help.visible=!0,this.update_sound_state(),egret.Tween.get(this.btn_go,{loop:!0}).to({anchorOffsetY:10},1e3).to({anchorOffsetY:0},1e3)},n.onclick_go=function(e){e.stopPropagation();var t=Game.Instance;this.parent.addChild(t),t.x=this.stage.stageWidth/2-540,this.parent.removeChild(this),this.img_bg.StopAni()},n.onclick_help=function(){this.addChild(new Help)},n.onclick_sound_off=function(e){SoundManager.Instance.IsMuted=!0,e.stopPropagation(),this.update_sound_state()},n.onclick_sound_on=function(e){SoundManager.Instance.IsMuted=!1,e.stopPropagation(),this.update_sound_state()},n.update_sound_state=function(){SoundManager.Instance.IsMuted?(this.btn_sound2.visible=!0,this.btn_sound1.visible=!1):(this.btn_sound1.visible=!0,this.btn_sound2.visible=!1)},t}(eui.Component);egret.registerClass(Start,"Start");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=960,this.textField.width=1080,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),this.loadingView.x=this.stage.stageWidth/2-540,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.startCreateScene=function(){GameConfig.ScaleMode=this.stage.scaleMode;var e=new Start;this.addChild(e),e.x=this.stage.stageWidth/2-540},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);